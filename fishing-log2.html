<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>é‡£æœä¸€è¦§ - AbyssAtlas</title>
    <link
      rel="icon"
      href="data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><defs><linearGradient id=%22abyss%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22><stop offset=%220%25%22 style=%22stop-color:%231a1413;stop-opacity:1%22 /><stop offset=%2250%25%22 style=%22stop-color:%2316191e;stop-opacity:1%22 /><stop offset=%22100%25%22 style=%22stop-color:%230d0a0a;stop-opacity:1%22 /></linearGradient><linearGradient id=%22metalGrad%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22><stop offset=%220%25%22 style=%22stop-color:%23ffd700;stop-opacity:0.9%22 /><stop offset=%2250%25%22 style=%22stop-color:%23d4af8c;stop-opacity:1%22 /><stop offset=%22100%25%22 style=%22stop-color:%238b7500;stop-opacity:0.9%22 /></linearGradient></defs><rect width=%22100%22 height=%22100%22 fill=%22url(%23abyss)%22/><polygon points=%2250,20 65,70 50,88 35,70%22 fill=%22url(%23metalGrad)%22 stroke=%22%23ffd700%22 stroke-width=%221.5%22/><polygon points=%2250,25 60,65 50,80 40,65%22 fill=%22none%22 stroke=%22%23ffffff%22 stroke-width=%220.8%22 opacity=%220.6%22/><path d=%22M20 50 Q50 40 80 50 Q50 55 20 50%22 stroke=%22%238b7500%22 stroke-width=%221.5%22 fill=%22none%22 opacity=%220.6%22/><path d=%22M15 60 Q50 50 85 60 Q50 65 15 60%22 stroke=%22%238b7500%22 stroke-width=%221%22 fill=%22none%22 opacity=%220.4%22/></svg>"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="stylesheet-darksoul.css" />
    <script type="module">
      import {
        auth,
        db,
        configValid,
        collection,
        getDocs,
        query,
        where,
        doc,
        getDoc,
        setDoc,
        updateDoc,
        arrayUnion,
        arrayRemove,
        onAuthStateChanged,
      } from "./firebase-init.js";

      // If firebase isn't configured, show a friendly message and stop.
      if (!configValid) {
        const el = document.getElementById("catchList");
        if (el) {
          el.innerHTML = `<div class="site-card">Firebase ãŒæœªæ§‹æˆã®ãŸã‚ãƒ‡ãƒ¼ã‚¿ã¯èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚firebase-config.js ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</div>`;
        }
      }

      // helper to set owner header (name + optional back-to-me button)
      function setOwnerHeader(name, uid, isSelf) {
        const hdr = document.getElementById("ownerHeader");
        if (!hdr) return;
        const backBtn = isSelf
          ? ""
          : `<button id='backToMeBtn' style='background: linear-gradient(135deg, #6b8fb0, #8099b8); color: white; border: 2px solid #c4d8f0; padding: 0.5rem 1rem; border-radius: 2px; cursor: pointer; font-weight: 600;'>è‡ªåˆ†ã«æˆ»ã‚‹</button>`;
        hdr.innerHTML = `<div style='display:flex;align-items:center;gap:12px;justify-content:space-between'><div><strong style='color:#4db8ff'>${escapeHtml(
          name
        )}</strong></div><div>${backBtn}</div></div>`;
        const btn = document.getElementById("backToMeBtn");
        if (btn) {
          btn.addEventListener("click", () => {
            if (window.currentUserUid) {
              setOwnerHeader("è‡ªåˆ†", window.currentUserUid, true);
              loadMyCatches(window.currentUserUid);
            }
          });
        }
      }

      // auth state: set global uid and trigger initial load when DOM is ready
      if (onAuthStateChanged && auth) {
        onAuthStateChanged(auth, (user) => {
          window.currentUserUid = user ? user.uid : null;
          // ensure DOM is parsed before attempting to render
          const start = () => {
            if (user) {
              // try to resolve displayName for header
              loadOwnerAndSetHeader(user.uid, true);
              loadMyCatches(user.uid);
              loadFriends(user.uid);
            } else {
              // clear owner header and show login hint
              const hdr = document.getElementById("ownerHeader");
              if (hdr)
                hdr.innerHTML = `<div class='subtle' style='color: #8099b8;'>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦è‡ªåˆ†ã®é‡£æœã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</div>`;
              const catchList = document.getElementById("catchList");
              if (catchList)
                catchList.innerHTML = `<p style='color: #8099b8; text-align: center;'>ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨è‡ªåˆ†ã¨å‹ã ã¡ã®é‡£æœã‚’é–²è¦§ã§ãã¾ã™ã€‚</p>`;
            }
          };
          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", start);
          } else {
            start();
          }
        });
      }

      // fetch user's displayName from users collection and set owner header
      async function loadOwnerAndSetHeader(uid, isSelf) {
        try {
          const udoc = await getDoc(doc(db, "users", uid));
          const d = udoc.exists() ? udoc.data() : {};
          const name = d.displayName || d.email || (isSelf ? "è‡ªåˆ†" : uid);
          setOwnerHeader(name, uid, isSelf);
        } catch (err) {
          console.warn("loadOwnerAndSetHeader failed", err);
          setOwnerHeader(isSelf ? "è‡ªåˆ†" : uid, uid, isSelf);
        }
      }

      // small utility to avoid XSS in simple strings
      function escapeHtml(s) {
        return String(s)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }
      // --- é‡£æœã‚’èª­ã¿è¾¼ã‚€é–¢æ•° ---
      async function loadMyCatches(uid) {
        const catchList = document.getElementById("catchList");
        catchList.innerHTML =
          "<p style='grid-column: 1 / -1; text-align: center; color: #8099b8; padding: 2rem;'>èª­ã¿è¾¼ã¿ä¸­...</p>";
        // Firestoreã‹ã‚‰ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é‡£æœã®ã¿ã‚’å–å¾—ï¼ˆæœ€é©åŒ–ï¼‰
        const q = query(collection(db, "fishinglogs"), where("uid", "==", uid));
        const querySnapshot = await getDocs(q);
        let html = "";
        querySnapshot.forEach((snap) => {
          const data = snap.data();
          const docId = snap.id;
          const fish = escapeHtml(
            (data && data.catch && data.catch.fish) || ""
          );
          const date = escapeHtml(
            (data && data.catch && data.catch.date) || ""
          );
          const size = escapeHtml(
            String((data && data.catch && data.catch.size) || "")
          );
          const weight = escapeHtml(
            String((data && data.catch && data.catch.weight) || "")
          );
          const location = escapeHtml(
            (data && data.catch && data.catch.location) || ""
          );

          // image thumbnail (use placeholder SVG when missing/invalid)
          const placeholderSvg = `
            <svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'>
              <rect width='100%' height='100%' fill='#e0e0e0'/>
              <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='32' fill='#666'>No Image</text>
            </svg>`;
          const placeholder =
            "data:image/svg+xml;utf8," + encodeURIComponent(placeholderSvg);
          const rawUrl = (data && data.catch && data.catch.imageUrl) || "";
          console.log(`Fish: ${fish}, rawUrl: ${rawUrl}, type: ${typeof rawUrl}`);
          const isValidUrl =
            typeof rawUrl === "string" &&
            (rawUrl.startsWith("http://") ||
              rawUrl.startsWith("https://") ||
              rawUrl.startsWith("data:") ||
              rawUrl.startsWith("blob:"));
          const imgTag = isValidUrl
            ? `<img src="${rawUrl}" alt="Catch Image" class="thumb-img" onerror="this.onerror=null;this.src=&quot;${placeholder}&quot;"/>`
            : `<img src="${placeholder}" alt="No Image" class="thumb-img"/>`;

          // simplified card with thumbnail on left and meta on right
          html += `<div class="catch-item" data-id="${docId}" tabindex="0" role="button">
            <div class="img-thumb">${imgTag}</div>
             <div class="meta compact">
              <p class="title"><strong>${fish}</strong> <small class="date">${date}</small></p>
              <p class="summary"><span class="label">ã‚µã‚¤ã‚º:</span> ${size} cm${
            weight ? " / " + weight + " g" : ""
          }</p>
              <p class="summary"><span class="label">å ´æ‰€:</span> ${location}</p>
            </div>
          </div>`;
        });
        if (html === "") {
          html =
            "<p style='grid-column: 1 / -1; text-align: center; color: #8099b8; padding: 2rem;'>ã¾ã é‡£æœãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
        }
        catchList.innerHTML = html;
      }

      // --- friends ç®¡ç† ---
      async function loadFriends(uid) {
        const friendsPanel = document.getElementById("friendsPanel");
        const friendsList = document.getElementById("friendsList");
        const input = document.getElementById("friendUidInput");
        friendsList.innerHTML = "<p style='color: #8099b8;'>èª­ã¿è¾¼ã¿ä¸­...</p>";
        try {
          const userDocRef = doc(db, "users", uid);
          const userSnap = await getDoc(userDocRef);
          const friends = (userSnap.exists() && userSnap.data().friends) || [];
          if (friends.length === 0) {
            friendsList.innerHTML =
              "<p style='color: #8099b8;'>å‹ã ã¡ãŒã„ã¾ã›ã‚“ã€‚</p>";
          } else {
            friendsList.innerHTML = "";
            // fetch each friend's public profile to show displayName/shortId
            for (const f of friends) {
              try {
                const friendDoc = await getDoc(doc(db, "users", f));
                const fd = friendDoc.exists() ? friendDoc.data() : {};
                const display = fd.displayName || fd.email || f;
                const short = fd.shortId ? ` (${fd.shortId})` : "";
                const el = document.createElement("div");
                el.className = "friend-item";
                el.innerHTML = `<span style="cursor:pointer;">${escapeHtml(
                  display
                )}${short} <small style="color:#777; margin-left:8px;">${f}</small></span> <button data-view="${f}" class="view-friend" style="margin-left:8px;padding:6px 8px;border-radius:6px;border:none;background:#0288d1;color:#fff;display:inline-flex;align-items:center;gap:6px;"><svg width="14" height="14" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" fill="currentColor"/></svg>è¡¨ç¤º</button> <button data-uid="${f}" class="remove-friend" style="margin-left:6px;padding:6px 8px;border-radius:6px;border:none;background:#e53935;color:#fff;display:inline-flex;align-items:center;gap:6px;"><svg width="14" height="14" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><polyline points="3 6 5 6 21 6" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>å‰Šé™¤</button>`;
                friendsList.appendChild(el);
              } catch (err) {
                const el = document.createElement("div");
                el.className = "friend-item";
                el.innerHTML = `<span style="cursor:pointer;">${f}</span> <button data-view="${f}" class="view-friend" style="margin-left:8px;padding:6px 8px;border-radius:6px;border:none;background:#0288d1;color:#fff;display:inline-flex;align-items:center;gap:6px;"><svg width="14" height="14" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" fill="currentColor"/></svg>è¡¨ç¤º</button> <button data-uid="${f}" class="remove-friend" style="margin-left:6px;padding:6px 8px;border-radius:6px;border:none;background:#e53935;color:#fff;display:inline-flex;align-items:center;gap:6px;"><svg width="14" height="14" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><polyline points="3 6 5 6 21 6" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>å‰Šé™¤</button>`;
                friendsList.appendChild(el);
              }
            }
            // attach remove handlers
            friendsList.querySelectorAll(".remove-friend").forEach((btn) => {
              btn.addEventListener("click", async (e) => {
                const friendUid = e.target.getAttribute("data-uid");
                await removeFriend(uid, friendUid);
                await loadFriends(uid);
              });
            });
            // attach view handlers
            friendsList.querySelectorAll(".view-friend").forEach((btn) => {
              btn.addEventListener("click", async (e) => {
                const friendUid = e.target.getAttribute("data-view");
                if (!friendUid) return;
                await loadFriendCatches(friendUid);
              });
            });
          }
        } catch (err) {
          console.error("loadFriends error", err);
          friendsList.innerHTML =
            "<p style='color: #8099b8;'>å‹ã ã¡ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>";
        }
        // add handler for add button
        const addBtn = document.getElementById("addFriendBtn");
        addBtn.onclick = async () => {
          let target = document.getElementById("friendUidInput").value.trim();
          if (!target)
            return alert("è¿½åŠ ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®UIDã¾ãŸã¯çŸ­ã„IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
          // if user inputs a 10-digit numeric shortId, resolve it to uid
          if (/^\d{10}$/.test(target)) {
            try {
              const q = query(
                collection(db, "users"),
                where("shortId", "==", target)
              );
              const snaps = await getDocs(q);
              if (snaps.empty) {
                alert("è©²å½“ã™ã‚‹çŸ­ã„IDã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
                return;
              }
              // take first match
              target = snaps.docs[0].id;
            } catch (err) {
              console.error("shortId lookup error", err);
              alert("çŸ­ã„IDã®ç…§ä¼šã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
              return;
            }
          }
          if (target === uid) return alert("è‡ªåˆ†ã‚’è¿½åŠ ã§ãã¾ã›ã‚“");
          await addFriend(uid, target);
          input.value = "";
          await loadFriends(uid);
        };
      }

      async function addFriend(uid, friendUid) {
        try {
          const userDocRef = doc(db, "users", uid);
          await setDoc(
            userDocRef,
            { friends: arrayUnion(friendUid) },
            { merge: true }
          );
        } catch (err) {
          console.error("addFriend error", err);
          alert("å‹ã ã¡è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ");
        }
      }

      async function removeFriend(uid, friendUid) {
        try {
          const userDocRef = doc(db, "users", uid);
          await updateDoc(userDocRef, { friends: arrayRemove(friendUid) });
        } catch (err) {
          console.error("removeFriend error", err);
          alert("å‹ã ã¡å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");
        }
      }

      // --- ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ•ãƒ¬ãƒ³ãƒ‰ï¼‰ã®é‡£æœã‚’èª­ã¿è¾¼ã‚€é–¢æ•° ---
      async function loadFriendCatches(friendUid) {
        const catchList = document.getElementById("catchList");
        catchList.innerHTML =
          "<p style='grid-column: 1 / -1; text-align: center; color: #8099b8; padding: 2rem;'>èª­ã¿è¾¼ã¿ä¸­...</p>";
        try {
          // fetch friend's profile for display name
          let display = friendUid;
          try {
            const friendDoc = await getDoc(doc(db, "users", friendUid));
            if (friendDoc.exists()) {
              const fd = friendDoc.data();
              display = fd.displayName || fd.email || friendUid;
            }
          } catch (e) {
            console.warn("friend profile fetch failed", e);
          }
          setOwnerHeader(display, friendUid, false);

          const q = query(
            collection(db, "fishinglogs"),
            where("uid", "==", friendUid)
          );
          const querySnapshot = await getDocs(q);
          let html = "";
          querySnapshot.forEach((snap) => {
            const data = snap.data();
            const docId = snap.id;
            const fish = escapeHtml(
              (data && data.catch && data.catch.fish) || ""
            );
            const date = escapeHtml(
              (data && data.catch && data.catch.date) || ""
            );
            const size = escapeHtml(
              String((data && data.catch && data.catch.size) || "")
            );
            const weight = escapeHtml(
              String((data && data.catch && data.catch.weight) || "")
            );
            const location = escapeHtml(
              (data && data.catch && data.catch.location) || ""
            );

            const placeholderSvg = `
            <svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'>
              <rect width='100%' height='100%' fill='#e0e0e0'/>
              <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='32' fill='#666'>No Image</text>
            </svg>`;
            const placeholder =
              "data:image/svg+xml;utf8," + encodeURIComponent(placeholderSvg);
            const rawUrl = (data && data.catch && data.catch.imageUrl) || "";
            const isValidUrl =
              typeof rawUrl === "string" &&
              (rawUrl.startsWith("http://") ||
                rawUrl.startsWith("https://") ||
                rawUrl.startsWith("data:") ||
                rawUrl.startsWith("blob:"));
            const imgTag = isValidUrl
              ? `<img src="${rawUrl}" alt="Catch Image" class="thumb-img" onerror="this.onerror=null;this.src=&quot;${placeholder}&quot;"/>`
              : `<img src="${placeholder}" alt="No Image" class="thumb-img"/>`;

            html += `<div class="catch-item" data-id="${docId}" tabindex="0" role="button">
              <div class="img-thumb">${imgTag}</div>
              <div class="meta compact">
                <p class="title"><strong>${fish}</strong> <small class="date">${date}</small></p>
                <p class="summary"><span class="label">ã‚µã‚¤ã‚º:</span> ${size} cm${
              weight ? " / " + weight + " g" : ""
            }</p>
                <p class="summary"><span class="label">å ´æ‰€:</span> ${location}</p>
              </div>
            </div>`;
          });
          if (html === "")
            html =
              "<p style='grid-column: 1 / -1; text-align: center; color: #8099b8; padding: 2rem;'>é‡£æœãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
          catchList.innerHTML = html;
        } catch (err) {
          console.error("loadFriendCatches error", err);
          catchList.innerHTML =
            "<p style='grid-column: 1 / -1; text-align: center; color: #8099b8; padding: 2rem;'>é‡£æœã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>";
        }
      }
      // å…¨ä½“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰è©³ç´°ãƒšãƒ¼ã‚¸ã¸é·ç§»ã™ã‚‹ï¼ˆç”»åƒé™å®šã§ã¯ãªãã‚«ãƒ¼ãƒ‰å…¨ä½“ï¼‰
      document.getElementById("catchList").addEventListener("click", (e) => {
        const item =
          e.target && e.target.closest ? e.target.closest(".catch-item") : null;
        if (item) {
          const id = item.getAttribute("data-id");
          if (id) {
            window.location.href = `fishing-log2-detail.html?id=${encodeURIComponent(
              id
            )}`;
          }
        }
      });
      // é‡£æœç™»éŒ²ãƒœã‚¿ãƒ³ã‹ã‚‰ç™»éŒ²ãƒšãƒ¼ã‚¸ã¸é·ç§»
      document.getElementById("toRegister").addEventListener("click", () => {
        window.location.href = "fishing-log.html";
      });
    </script>

    <!-- page-specific styles moved to stylesheet.css -->
  </head>

  <body>
    <header>
      <div class="container">
        <div class="header-left">
          <a
            class="logo"
            href="index.html"
            aria-label="ãƒ›ãƒ¼ãƒ "
            title="ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹"
          >
            <svg
              width="40"
              height="40"
              viewBox="0 0 100 100"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              focusable="false"
            >
              <defs>
                <linearGradient
                  id="abyss-logo2"
                  x1="0%"
                  y1="0%"
                  x2="100%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #1a1413; stop-opacity: 1"
                  />
                  <stop
                    offset="50%"
                    style="stop-color: #16191e; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #0d0a0a; stop-opacity: 1"
                  />
                </linearGradient>
                <linearGradient
                  id="metalGrad-logo2"
                  x1="0%"
                  y1="0%"
                  x2="100%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #c4d8f0; stop-opacity: 0.9"
                  />
                  <stop
                    offset="50%"
                    style="stop-color: #8099b8; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #506080; stop-opacity: 0.9"
                  />
                </linearGradient>
              </defs>
              <polygon
                points="50,20 65,70 50,88 35,70"
                fill="url(#metalGrad-logo2)"
                stroke="#c4d8f0"
                stroke-width="1.5"
              />
              <polygon
                points="50,25 60,65 50,80 40,65"
                fill="none"
                stroke="#ffffff"
                stroke-width="0.8"
                opacity="0.6"
              />
              <path
                d="M20 50 Q50 40 80 50 Q50 55 20 50"
                stroke="#8099b8"
                stroke-width="1.5"
                fill="none"
                opacity="0.6"
              />
            </svg>
          </a>
        </div>
        <div class="header-right">
          <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
          <a href="fishing-log2.html">é‡£æœä¸€è¦§</a>
          <a href="fishing-log.html">ç™»éŒ²</a>
          <div class="nav-tools">
            <button
              class="tools-btn"
              aria-haspopup="true"
              aria-expanded="false"
            >
              ãƒ„ãƒ¼ãƒ« â–¾
            </button>
            <div class="submenu" role="menu">
              <a role="menuitem" href="ocean-checker.html">ğŸŒŠ æµ·æ³ãƒã‚§ãƒƒã‚«ãƒ¼</a>
              <a role="menuitem" href="pe-converter.html">PEå¤‰æ›</a>
              <a role="menuitem" href="index.html">ãã®ä»–</a>
            </div>
          </div>
          <a href="profile.html">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
        </div>
        <button class="menu-icon" id="menuIcon" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
            focusable="false"
          >
            <path
              d="M4 6h16M4 12h16M4 18h16"
              stroke="currentColor"
              stroke-width="1.6"
              stroke-linecap="round"
            />
          </svg>
        </button>
      </div>
    </header>
    <div class="wave top">
      <svg
        viewBox="0 0 1440 120"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill="#3a4d6b"
          fill-opacity="0.5"
          d="M0,80 C360,160 1080,0 1440,80 L1440,120 L0,120 Z"
        ></path>
      </svg>
    </div>
    <h2
      style="
        color: #c4d8f0;
        text-shadow: 0 0 20px rgba(196, 216, 240, 0.6);
        text-align: center;
        margin-top: 1rem;
        margin-bottom: 1rem;
      "
    >

        <path
          d="M22 12c0 0-4-2-8-2s-8 2-8 2S2 14 2 18s3 4 7 4 6-2 8-4 5-4 5-6-1-2-1-2z"
          fill="none"
          stroke="currentColor"
          stroke-width="1.2"
          stroke-linecap="round"
          stroke-linejoin="round"
        ></path>
        <circle cx="7" cy="12" r="1" fill="currentColor"></circle>
      </svg>
      é‡£æœä¸€è¦§
    </h2>
    <div
      id="ownerHeader"
      class="ownerHeader"
      style="
        text-align: center;
        color: #c4d8f0;
        margin: 1rem 0;
        font-size: 1.1rem;
      "
    ></div>
    <div
      id="catchList"
      class="catch-list"
      role="list"
      style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin: 2rem auto;
        max-width: 1200px;
        padding: 0 1rem;
      "
    >
      <div class="empty-state">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <!-- Friends panel -->
    <section
      id="friendsPanel"
      class="friends-panel"
      style="
        background: linear-gradient(
          135deg,
          rgba(15, 20, 35, 0.95),
          rgba(10, 25, 45, 0.95)
        );
        border: 2px solid #3a4d6b;
        border-radius: 2px;
        padding: 1.5rem;
        margin: 2rem auto;
        max-width: 900px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.8);
      "
    >
      <h3 style="color: #c4d8f0; margin-top: 0">å‹ã ã¡ç®¡ç†</h3>
      <div
        style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px"
      >
        <input
          id="friendUidInput"
          placeholder="å‹ã ã¡ã®UIDã‚’å…¥åŠ›"
          style="
            flex: 1;
            padding: 8px;
            border-radius: 2px;
            border: 1px solid #506080;
            background: rgba(5, 4, 4, 0.6);
            color: #c4d8f0;
          "
        />
        <button
          id="addFriendBtn"
          style="
            padding: 8px 12px;
            border-radius: 2px;
            background: linear-gradient(135deg, #6b8fb0, #8099b8);
            color: white;
            border: 2px solid #c4d8f0;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
          "
        >
          è¿½åŠ 
        </button>
      </div>
      <div id="friendsList" style="color: #c4d8f0">èª­ã¿è¾¼ã¿ä¸­...</div>
    </section>
    <div
      class="action-row"
      style="
        display: flex;
        gap: 12px;
        justify-content: center;
        margin: 2rem auto;
        max-width: 900px;
        padding: 1rem;
      "
    >
      <button
        id="toRegister"
        style="
          background: linear-gradient(135deg, #6b8fb0, #8099b8);
          color: white;
          border: 2px solid #c4d8f0;
          padding: 0.75rem 1.5rem;
          border-radius: 2px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
        "
      >
        é‡£æœç™»éŒ²ã¸
      </button>
      <button
        id="logout"
        style="
          background: rgba(0, 0, 0, 0.3);
          color: #8099b8;
          border: 1px solid #506080;
          padding: 0.75rem 1.5rem;
          border-radius: 2px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
        "
      >
        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
      </button>
    </div>
    <div class="wave bottom">
      <svg
        viewBox="0 0 1440 120"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill="#3a4d6b"
          fill-opacity="0.5"
          d="M0,80 C360,160 1080,0 1440,80 L1440,120 L0,120 Z"
        ></path>
      </svg>
    </div>
    <!-- home button styling moved to stylesheet.css -->
    <script>
      const homeBtn = document.getElementById("homeBtn");
      if (homeBtn) {
        homeBtn.addEventListener("click", () => {
          window.location.href = "index.html";
        });
      }
    </script>
    <script src="scripts/header.js"></script>
  </body>
</html>
