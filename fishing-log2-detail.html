<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>é‡£æœè©³ç´°</title>
    <style>
      body {
        font-family: "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: linear-gradient(135deg, #a2d4f7 0%, #0e6ba8 100%);
        position: relative;
        overflow-x: hidden;
      }
      h1 {
        color: #fff;
        text-align: center;
        margin-top: 40px;
        text-shadow: 0 2px 8px #0e6ba8cc;
        letter-spacing: 2px;
      }
      #fishinglogs {
        background: rgba(255, 255, 255, 0.97);
        border-radius: 18px 18px 30px 30px;
        padding: 24px 18px 32px 18px;
        margin: 32px auto 40px auto;
        max-width: 500px;
        box-shadow: 0 4px 16px 0 #0e6ba84d;
        border-bottom: 8px solid #4fc3f7;
        border-top: 2px solid #b3e5fc;
        position: relative;
        z-index: 1;
      }
      #fishinglogs img {
        box-shadow: 0 4px 16px #4fc3f7aa;
        border: 3px solid #b3e5fc;
        background: #e1f5fe;
        border-radius: 10px;
        margin-top: 12px;
        max-width: 100%;
        height: auto;
        display: block;
        margin-left: auto;
        margin-right: auto;
      }
      /* æ³¢ã®è£…é£¾ */
      .wave {
        position: absolute;
        left: 0;
        width: 100%;
        height: 120px;
        pointer-events: none;
        z-index: 0;
      }
      .wave.top {
        top: 0;
        transform: rotate(180deg);
      }
      .wave.bottom {
        bottom: 0;
      }
    </style>
    <body>
      <div class="wave top">
        <svg
          viewBox="0 0 1440 120"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill="#4fc3f7"
            fill-opacity="0.5"
            d="M0,80 C360,160 1080,0 1440,80 L1440,120 L0,120 Z"
          ></path>
        </svg>
      </div>
      <h1>é‡£æœè©³ç´°</h1>
      <div id="fishinglogs">èª­ã¿è¾¼ã¿ä¸­...</div>
      <div class="wave bottom">
        <svg
          viewBox="0 0 1440 120"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill="#4fc3f7"
            fill-opacity="0.5"
            d="M0,80 C360,160 1080,0 1440,80 L1440,120 L0,120 Z"
          ></path>
        </svg>
      </div>

      <!-- ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
      <button id="homeBtn" class="home-btn" title="ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹">ğŸ </button>
      <style>
        .home-btn {
          position: fixed;
          right: 18px;
          bottom: 18px;
          z-index: 9999;
          width: 48px;
          height: 48px;
          border-radius: 50%;
          border: none;
          background: linear-gradient(90deg, #0288d1 0%, #26c6da 100%);
          color: #fff;
          font-size: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
          cursor: pointer;
        }
        .home-btn:hover {
          filter: brightness(1.05);
        }
      </style>
      <script>
        document.getElementById("homeBtn").addEventListener("click", () => {
          window.location.href = "index.html";
        });
      </script>

      <script type="module">
        // Use centralized initializer (v12) and import only needed firestore helpers
        import { db } from "./firebase-init.js";
        import {
          doc,
          getDoc,
          collection,
          query,
          where,
          getDocs,
        } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        const urlParams = new URLSearchParams(window.location.search);
        const logId = urlParams.get("id"); // URLã‹ã‚‰IDã‚’å–å¾—
        const imgParam = urlParams.get("img"); // imgãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
        const fishinglogsDiv = document.getElementById("fishinglogs");
        //é‡£æœã®è©³ç´°ã‚’å–å¾—ã—ã¦è¡¨ç¤º
        async function showFishingLogData(data) {
          fishinglogsDiv.innerHTML = `
            <h2>${data.catch.fish} (${data.catch.size} cm)</h2>
            <p><strong>å ´æ‰€:</strong> ${data.catch.location}</p>
            <p><strong>æ—¥ä»˜:</strong> ${data.catch.date}</p>
            <p><strong>ãƒ¡ãƒ¢:</strong> ${data.catch.memo}</p>
            <p><strong>ãƒ­ãƒƒãƒ‰:</strong> ${data.catch.rod}</p>
            <p><strong>ãƒªãƒ¼ãƒ«:</strong> ${data.catch.reel}</p>
            <p><strong>ãƒ©ã‚¤ãƒ³:</strong> ${data.catch.line}</p>
            <p><strong>ä»•æ›ã‘ or ãƒ«ã‚¢ãƒ¼ç­‰:</strong> ${data.catch.lure}</p>
            <img src="${data.catch.imageUrl}" alt="Catch Image" />
          `;
        }

        async function fetchFishingLogById(id) {
          try {
            const docRef = doc(db, "fishinglogs", id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
              showFishingLogData(docSnap.data());
            } else {
              fishinglogsDiv.innerHTML = "ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚";
            }
          } catch (error) {
            console.error(error);
            fishinglogsDiv.innerHTML = "ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
          }
        }

        async function fetchFishingLogByImageUrl(imageUrl) {
          try {
            const q = query(
              collection(db, "fishinglogs"),
              where("catch.imageUrl", "==", imageUrl)
            );
            const querySnapshot = await getDocs(q);
            if (!querySnapshot.empty) {
              // æœ€åˆã«ä¸€è‡´ã—ãŸã‚‚ã®ã‚’è¡¨ç¤º
              showFishingLogData(querySnapshot.docs[0].data());
            } else {
              fishinglogsDiv.innerHTML =
                "ç”»åƒURLã«è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚";
            }
          } catch (error) {
            console.error(error);
            fishinglogsDiv.innerHTML = "ç”»åƒURLæ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
          }
        }

        if (logId) {
          fetchFishingLogById(logId);
        } else if (imgParam) {
          fetchFishingLogByImageUrl(imgParam);
        } else {
          fishinglogsDiv.innerHTML =
            "URLã«idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¾ãŸã¯imgãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
        }
      </script>
    </body>
  </head>
</html>
